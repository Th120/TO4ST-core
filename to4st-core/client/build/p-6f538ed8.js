import{r as s,c as t,h as i,H as e}from"./p-89d64653.js";import{i as a,a as l,_ as n,e as o,b as h,c,n as r,d}from"./p-18a1d9b0.js";var v=Math.ceil,u=Math.max,f=function(s,t,i){if(!a(i))return!1;var e=typeof t;return!!("number"==e?l(i)&&n(t,i.length):"string"==e&&t in i)&&o(i[t],s)},b=/\s/,m=/^\s+/,p=function(s){return s?s.slice(0,function(s){for(var t=s.length;t--&&b.test(s.charAt(t)););return t}(s)+1).replace(m,""):s},g=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,C=/^0o[0-7]+$/i,S=parseInt,w=function(s){if("number"==typeof s)return s;if(function(s){return"symbol"==typeof s||h(s)&&"[object Symbol]"==c(s)}(s))return NaN;if(a(s)){var t="function"==typeof s.valueOf?s.valueOf():s;s=a(t)?t+"":t}if("string"!=typeof s)return 0===s?s:+s;s=p(s);var i=y.test(s);return i||C.test(s)?S(s.slice(2),i?2:8):g.test(s)?NaN:+s},O=function(s){return s?1/0===(s=w(s))||-1/0===s?17976931348623157e292*(s<0?-1:1):s==s?s:0:0===s?s:0},j=function(s,t,i){return i&&"number"!=typeof i&&f(s,t,i)&&(t=i=void 0),s=O(s),void 0===t?(t=s,s=0):t=O(t),function(s,t,i,e){for(var a=-1,l=u(v((t-s)/(i||1)),0),n=Array(l);l--;)n[e?l:++a]=s,s+=i;return n}(s,t,i=void 0===i?s<t?1:-1:O(i),void 0)},I=function(s,t,i){var e=-1,a=s.length;t<0&&(t=-t>a?0:a+t),(i=i>a?a:i)<0&&(i+=a),a=t>i?0:i-t>>>0,t>>>=0;for(var l=Array(a);++e<a;)l[e]=s[e+t];return l},E=Math.ceil,k=Math.max,x=function(s,t,i){t=(i?f(s,t,i):void 0===t)?1:k(function(s){var t=O(s),i=t%1;return t==t?i?t-i:t:0}(t),0);var e=null==s?0:s.length;if(!e||t<1)return[];for(var a=0,l=0,n=Array(E(e/t));a<e;)n[l++]=I(s,a,a+=t);return n},N=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;const T=class{constructor(e){s(this,e),this.updateEntities=t(this,"updateEntities",7),this.deleteEntity=t(this,"deleteEntity",7),this.saveEntity=t(this,"saveEntity",7),this.afterSave=t(this,"afterSave",7),this.filters=[],this.hasSearch=!1,this.useDefaultListCreate=!1,this.columnsCount=3,this.columns=[],this.loadingInputBlock=!1,this.stripedTable=!1,this.listHasPagination=!0,this.entities=[],this.currentPage=1,this.currentPageCount=1,this.currentSearch="",this.orderDesc=!0,this.currentOrderBy="",this.currentError="",this.hasValidNames=!1,this.freeze=!1,this.deleteActive=!1,this.renderSetter=s=>i("div",{class:"tile is-parent"},i("div",{class:"tile is-child"},(null==s?void 0:s.detailInput)?i("div",{class:"field"},i("div",{class:"field-label is-normal"},i("label",{class:"label has-text-left"},s.name)),i("div",{class:"field-body"},i("div",{class:"control"},i("span",{class:"has-tooltip-arrow has-tooltip-left","data-tooltip":s.tooltip?s.tooltip(this.currentItem):void 0},s.detailInput(this.currentItemClone,((s,t)=>{this.currentItemClone&&(this.currentItemClone[s]=t,this.currentItemClone=Object.assign({},this.currentItemClone))})))))):i("div",null,"Â ")))}defaultCreateObjectChanged(){this.defaultCreateObject&&this.currentItem&&(this.currentItem=Object.assign(Object.assign({},this.defaultCreateObject),this.currentItem),this.reset())}async componentWillLoad(){this.resetTransactionId(),await this.updateContent()}async updateContent(){this.updateEntities.emit({page:this.currentPage,search:this.currentSearch,orderBy:this.currentOrderBy,orderDesc:this.orderDesc,onFetchedData:(s,t)=>{this.entities=s,this.currentPageCount=t}})}async searchEntity(s){this.currentSearch=s,await this.updateContent()}async _saveEntity(s,t,i){this.freeze=!0,this.saveEntity.emit({entity:s,transactionId:this.currentFormTransactionId,afterEx:i})}async goToPage(s){this.currentPage=s,await this.updateContent()}async removeEntity(s){this.deleteActive=!1,this.deleteEntity.emit({entity:s,onDeletedEntity:()=>{this.updateContent(),this.currentItem=void 0,this.currentItemClone=void 0}})}itemSelected(s){console.log(s),this.currentItem=Object.assign(Object.assign({},this.defaultCreateObject),s),this.reset()}reset(){this.currentItemClone=Object.assign({},this.currentItem)}copy(){const s=this.currentItemAsString();s&&sessionStorage.setItem(this.getIdentString(),s)}import(s){if((null==s?void 0:s.length)>0){const t=new FileReader;t.onload=s=>{const t=s.target.result.toString();this.pasteFromString(t)},t.onerror=s=>{console.error("Error reading file : "+s)},t.readAsText(s[0])}}downloadJSON(s,t){const i=document.createElement("a");i.href=URL.createObjectURL(new Blob([t],{type:"text/plain"})),i.setAttribute("download",s+".txt"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}export(){var s;const t=this.currentItemAsString();t&&this.downloadJSON((null===(s=this.mapPreSerializeEntity)||void 0===s?void 0:s.call(this,this.currentItemClone).fileName)||this.name,t)}paste(){const s=sessionStorage.getItem(this.getIdentString());this.pasteFromString(s)}currentItemAsString(){return this.currentItemClone?JSON.stringify(this.mapPreSerializeEntity?this.mapPreSerializeEntity(this.currentItemClone).mapped:this.currentItemClone,null,"\t"):""}pasteFromString(s){if(s&&s.trim()){const t=JSON.parse(s,((s,t)=>"string"==typeof t&&N.test(t)?new Date(t):t)),i={};Object.keys(t).forEach((s=>{i[s]=t[s]})),this.currentItemClone=i}}orderBy(s,t){var i,e;this.orderDesc=t,this.currentOrderBy=null!==(e=null===(i=this.mapOrderByAssign)||void 0===i?void 0:i.call(this,s))&&void 0!==e?e:s,this.updateContent()}getIdentString(){return`${this.name}_copied_preset`}resetTransactionId(){this.currentFormTransactionId=r()}async afterSuccessHandler(s){this.freeze=!1,this.resetTransactionId(),this.currentError=s.detail,await this.updateContent()}render(){const s=x(this.columns.filter((s=>!!s.detailInput)),this.columnsCount);if(s.length>0){const t=s[s.length-1],i=this.columnsCount-t.length;if(i>0){const s=j(i).map((()=>({})));t.push(...s)}}return i(e,null,i("div",{class:"columns"},i("div",{class:"column is-narrow"},i("to4st-list",{name:this.name,loadingInputBlock:this.loadingInputBlock,striped:this.stripedTable,filters:this.filters,columns:this.columns,content:this.entities,allowSelect:!0,hasSearch:this.hasSearch,pagesCount:this.currentPageCount,currentPage:this.currentPage,hasCreate:this.useDefaultListCreate,hasPagination:this.listHasPagination,hasUpdate:!1,onChangedOrder:s=>this.orderBy(s.detail.orderBy,s.detail.orderDesc),onItemSelected:s=>this.itemSelected(s.detail),onPagination:s=>this.goToPage(s.detail),onSaveItem:s=>this._saveEntity(s.detail.item,s.detail.isEdit,s.detail.afterSaveExecuted),onSearchItem:s=>this.searchEntity(s.detail),onRemoveItem:s=>this.removeEntity(s.detail)})),i("div",{class:"column has-margin-top-30"},i("article",{class:"message"},i("div",{class:"message-header"},i("p",null,"Details"),i("div",{class:{"field has-addons":!0,"is-hidden":!this.mapPreSerializeEntity}},i("div",{class:"control"},i("button",{disabled:this.freeze||!this.currentItemClone,class:"button is-small",onClick:()=>this.copy()},"Copy")),i("div",{class:"control"},i("button",{disabled:this.freeze||!this.currentItemClone,class:"button is-small",onClick:()=>this.paste()},"Paste")))),i("div",{class:"message-body"},i("div",{class:{"notification is-danger":!0,"is-hidden":0==this.currentError.length}},i("button",{class:"delete",onClick:()=>this.currentError=""}),this.currentError),i("div",{class:"container"},s.map((s=>i("div",{class:"tile is-ancestor has-margin-bottom-0"},s.map((s=>this.renderSetter(s))))))),i("div",{class:"container has-margin-top-30"},i("div",{class:"level"},i("div",{class:"level-left"},i("div",{class:"level-item"},i("div",{class:"field level-item"},i("div",{class:"control"},i("button",{class:"button is-success",disabled:this.freeze||!this.currentItemClone,onClick:()=>this._saveEntity(this.currentItemClone,!0,this.afterSave)},"Save")))),i("div",{class:"level-item"},i("div",{class:"field"},i("div",{class:"control"},i("button",{class:"button is-small is-warning",disabled:d(this.currentItem,this.currentItemClone),onClick:()=>this.reset()},"Reset"))))),i("div",{class:{"level-item":!0,"is-hidden":!this.mapPreSerializeEntity}},i("div",{class:"field has-addons"},i("div",{class:"control"},i("div",{class:"file is-small"},i("label",{class:"file-label"},i("input",{class:"file-input is-small",disabled:this.freeze||!this.currentItemClone,type:"file",name:"resume",onChange:s=>this.import(s.target.files)}),i("span",{class:"file-cta"},i("span",{class:"file-icon"},i("i",{class:"fas fa-upload"})),i("span",{class:"file-label"},"Import"))))),i("div",{class:"control"},i("button",{disabled:this.freeze||!this.currentItemClone,class:"button is-small is-info",onClick:()=>this.export()},"Export")))),i("div",{class:{"level-right":!0}},i("div",{class:"level-item"},i("div",{class:"field"},i("div",{class:"control"},i("to4st-switch",{disabled:!this.currentItemClone||this.canItemBeDeleted&&!this.canItemBeDeleted(this.currentItemClone),value:this.deleteActive,onToggle:s=>this.deleteActive=s.detail})))),i("div",{class:"level-item"},i("div",{class:"field"},i("div",{class:"control"},i("span",{class:"has-tooltip-arrow","data-tooltip":this.deleteActive?void 0:"Toggle switch \n to unlock"},i("button",{class:"button is-danger",disabled:!this.deleteActive||!this.currentItemClone||this.canItemBeDeleted&&!this.canItemBeDeleted(this.currentItemClone),onClick:()=>this.removeEntity(this.currentItemClone)},i("i",{class:"fas fa-trash-alt"}))))))))))))))}static get watchers(){return{defaultCreateObject:["defaultCreateObjectChanged"]}}};T.style="";export{T}